<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindb Console</title>
    <link rel="stylesheet" href="/console/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="connection-status" id="connectionStatus">
                        <span class="status-dot"></span>
                        <span class="status-text">Disconnected</span>
                    </div>
                </div>
                <div class="logo">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"
                    role="img" aria-labelledby="title-db" fill="none" stroke="currentColor"
                    stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                 <title id="title-db">Database icon</title>
                 <ellipse cx="12" cy="6" rx="7.5" ry="3.5"/>
                 <path d="M4.5 6v8c0 2.1 3.36 4.1 7.5 4.1s7.5-2 7.5-4.1V6"/>
                 <path d="M4.5 10c0 2.1 3.36 4.1 7.5 4.1s7.5-2 7.5-4.1"/>
               </svg>
                    <h1>Mindb Console</h1>
                </div>
                <div class="header-right">
                    <span id="userInfo" style="display: none; margin-right: 1rem; color: var(--text-muted); font-size: 0.875rem;"></span>
                    <button class="btn btn-secondary btn-sm" id="logoutBtn" style="display: none;">
                        Logout
                    </button>
                    <button class="btn btn-secondary btn-sm" id="disconnectBtn" style="display: none;">
                        Disconnect
                    </button>
                </div>
            </div>
        </header>

        <!-- Tabs (hidden until connected) -->
        <div class="tabs" id="tabsContainer" style="display: none;">
            <button class="tab-btn active" data-tab="query">Query Editor</button>
            <button class="tab-btn" data-tab="procedures">Stored Procedures</button>
            <button class="tab-btn" data-tab="history">History</button>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Login Panel -->
            <div class="panel login-panel" id="loginPanel">
                <div class="panel-header">
                    <h2>Login</h2>
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <label for="loginUsername">Username</label>
                        <input type="text" id="loginUsername" placeholder="Enter username" required autofocus>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter password" required>
                    </div>
                    <div class="form-group">
                        <label for="loginHost">Host (optional)</label>
                        <input type="text" id="loginHost" placeholder="%" value="%">
                        <small style="color: var(--text-muted); font-size: 0.8125rem; margin-top: 0.25rem; display: block;">
                            Use % for any host, or specify IP address
                        </small>
                    </div>
                    <div id="loginError" class="error-message" style="display: none;"></div>
                    <button class="btn btn-primary" id="loginBtn">Login</button>
                </div>
            </div>

            <!-- Connection Panel -->
            <div class="panel connection-panel" id="connectionPanel" style="display: none;">
                <div class="panel-header">
                    <h2>Connection Settings</h2>
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <label for="serverUrl">Server URL (leave empty for same server)</label>
                        <input type="text" id="serverUrl" placeholder="Leave empty for same server" value="">
                    </div>
                    <div class="form-group">
                        <label for="database">Database (optional)</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="text" id="database" placeholder="mydb" style="flex: 1;">
                            <button class="btn btn-secondary" id="createDbBtn" title="Create new database">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                New DB
                            </button>
                        </div>
                        <small style="color: var(--text-muted); font-size: 0.8125rem; margin-top: 0.25rem; display: block;">
                            Enter a database name or create a new one
                        </small>
                    </div>
                    <button class="btn btn-primary" id="connectBtn">Connect</button>
                </div>
            </div>

            <!-- Query Tab Content -->
            <div class="tab-content" id="queryTab" style="display: none;">
            <div class="panel query-panel" id="queryPanel">
                <div class="panel-header">
                    <h2>SQL Query Editor</h2>
                    <div class="panel-actions">
                        <button class="btn btn-secondary btn-sm" id="clearBtn">Clear</button>
                        <button class="btn btn-primary btn-sm" id="executeBtn">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M3 2L13 8L3 14V2Z" fill="currentColor"/>
                            </svg>
                            Execute
                        </button>
                    </div>
                </div>
                <div class="panel-body">
                    <textarea id="sqlEditor" class="sql-editor" placeholder="Enter your SQL query here"></textarea>
                    <div class="editor-footer">
                        <div class="editor-info">
                            <span id="lineCount">Line 1</span>
                            <span class="separator">|</span>
                            <span id="charCount">0 characters</span>
                        </div>
                        <div class="quick-actions">
                            <button class="btn-link" onclick="insertSample('SELECT')">SELECT</button>
                            <button class="btn-link" onclick="insertSample('INSERT')">INSERT</button>
                            <button class="btn-link" onclick="insertSample('CREATE')">CREATE</button>
                            <button class="btn-link" onclick="insertSample('DESCRIBE')">DESCRIBE</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel results-panel" id="resultsPanel">
                <div class="panel-header">
                    <h2>Query Results</h2>
                    <div class="panel-actions">
                        <button class="btn btn-secondary btn-sm" id="exportBtn">Export CSV</button>
                    </div>
                </div>
                <div class="panel-body">
                    <div id="resultsContent">
                        <div class="empty-state">
                            <p>Execute a query to see results here</p>
                        </div>
                    </div>
                </div>
            </div>
            </div>

            <!-- Stored Procedures Tab Content -->
            <div class="tab-content" id="proceduresTab" style="display: none;">
                <div class="panel">
                    <div class="panel-header">
                        <h2>Stored Procedures</h2>
                        <button class="btn btn-primary btn-sm" onclick="showUploadProcedureForm()">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            Upload New
                        </button>
                    </div>
                    <div class="panel-body">
                        <div id="uploadProcedureForm" style="display: none; margin-bottom: 2rem; padding: 1.5rem; background: var(--bg-secondary); border-radius: 8px;">
                            <div class="form-group">
                                <label for="procedureName">Function Name</label>
                                <input type="text" id="procedureName" placeholder="calculate_discount">
                                <small style="color: var(--text-muted); font-size: 0.8125rem; margin-top: 0.25rem; display: block;">
                                    Must match the exported function name in your WASM module
                                </small>
                            </div>
                            
                            <div class="form-group">
                                <label for="wasmFile">WASM File</label>
                                <input type="file" id="wasmFile" accept=".wasm" style="padding: 0.5rem;">
                                <small style="color: var(--text-muted); font-size: 0.8125rem; margin-top: 0.25rem; display: block;">
                                    Parameters and return type will be auto-detected from the WASM module
                                </small>
                            </div>
                            
                            <div class="form-group">
                                <label for="procedureDescription">Description (optional)</label>
                                <textarea id="procedureDescription" placeholder="What does this procedure do?" style="width: 100%; min-height: 60px; padding: 0.75rem 1rem; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: inherit; resize: vertical;"></textarea>
                            </div>
                            
                            <div style="display: flex; gap: 0.75rem; justify-content: flex-end;">
                                <button class="btn btn-secondary" onclick="hideUploadProcedureForm()">Cancel</button>
                                <button class="btn btn-primary" id="uploadProcedureBtn">Upload Procedure</button>
                            </div>
                        </div>
                        
                        <div id="proceduresList">
                            <div class="empty-state">
                                <p>No stored procedures yet</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Tab Content -->
            <div class="tab-content" id="historyTab" style="display: none;">
            <div class="panel history-panel" id="historyPanel">
                <div class="panel-header">
                    <h2>Query History</h2>
                    <div class="panel-actions">
                        <button class="btn btn-secondary btn-sm" id="clearHistoryBtn">Clear History</button>
                    </div>
                </div>
                <div class="panel-body">
                    <div id="historyContent">
                        <div class="empty-state">
                            <p>No query history yet</p>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </main>
    </div>

    <!-- Modal for Examples -->
    <div class="modal" id="examplesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>SQL Examples</h2>
                <button class="modal-close" onclick="closeModal('examplesModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="example-category">
                    <h3>Table Operations</h3>
                    <div class="example-item" onclick="useExample(this)">
                        <code>DESCRIBE users;</code>
                    </div>
                    <div class="example-item" onclick="useExample(this)">
                        <code>CREATE TABLE users (id INT PRIMARY KEY, name TEXT, email TEXT);</code>
                    </div>
                    <div class="example-item" onclick="useExample(this)">
                        <code>DROP TABLE users;</code>
                    </div>
                </div>
                <div class="example-category">
                    <h3>Data Manipulation</h3>
                    <div class="example-item" onclick="useExample(this)">
                        <code>INSERT INTO users (id, name, email) VALUES (1, 'Alice', 'alice@example.com');</code>
                    </div>
                    <div class="example-item" onclick="useExample(this)">
                        <code>SELECT * FROM users;</code>
                    </div>
                    <div class="example-item" onclick="useExample(this)">
                        <code>SELECT * FROM users WHERE id = 1;</code>
                    </div>
                    <div class="example-item" onclick="useExample(this)">
                        <code>UPDATE users SET email = 'newemail@example.com' WHERE id = 1;</code>
                    </div>
                    <div class="example-item" onclick="useExample(this)">
                        <code>DELETE FROM users WHERE id = 1;</code>
                    </div>
                </div>
                <div class="example-category">
                    <h3>Transactions</h3>
                    <div class="example-item" onclick="useExample(this)">
                        <code>BEGIN;</code>
                    </div>
                    <div class="example-item" onclick="useExample(this)">
                        <code>COMMIT;</code>
                    </div>
                    <div class="example-item" onclick="useExample(this)">
                        <code>ROLLBACK;</code>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Create Database -->
    <div class="modal" id="createDbModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Create New Database</h2>
                <button class="modal-close" onclick="closeModal('createDbModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="newDbName">Database Name</label>
                    <input type="text" id="newDbName" placeholder="Enter database name" autofocus>
                    <small style="color: var(--text-muted); font-size: 0.8125rem; margin-top: 0.25rem; display: block;">
                        Use alphanumeric characters and underscores only
                    </small>
                </div>
                <div style="display: flex; gap: 0.75rem; justify-content: flex-end; margin-top: 1.5rem;">
                    <button class="btn btn-secondary" onclick="closeModal('createDbModal')">Cancel</button>
                    <button class="btn btn-primary" id="confirmCreateDbBtn">Create Database</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/console/app.js"></script>
</body>
</html>
